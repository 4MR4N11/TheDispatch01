<div class="edit-profile-page">
  <div class="edit-profile-container">
    <!-- Header -->
    <div class="page-header">
      <h1 class="page-title">Edit Profile</h1>
      <p class="page-subtitle">Update your account information</p>
    </div>

    @if (loading() && !uploading()) {
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading profile...</p>
      </div>
    } @else {
      <form class="profile-form" (ngSubmit)="updateProfile()">
        <!-- Avatar Section -->
        <div class="form-section">
          <h2 class="section-title">Profile Picture</h2>
          <div class="avatar-upload">
            <div class="avatar-preview">
              @if (avatarPreview) {
                <img [src]="avatarPreview" alt="Avatar preview" class="avatar-image">
              } @else {
                <div class="avatar-placeholder">
                  <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                  </svg>
                </div>
              }
            </div>
            <div class="avatar-actions">
              <label for="avatar-input" class="btn-upload">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                </svg>
                Choose Image
              </label>
              <input
                type="file"
                id="avatar-input"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                (change)="onFileSelected($event)"
                style="display: none;">
              @if (avatarPreview) {
                <button type="button" class="btn-remove" (click)="removeAvatar()">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                  Remove
                </button>
              }
            </div>
            <p class="avatar-hint">JPG, PNG, GIF or WebP. Max 5MB</p>
          </div>
        </div>

        <!-- Personal Information -->
        <div class="form-section">
          <h2 class="section-title">Personal Information</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input
                type="text"
                id="firstName"
                name="firstName"
                [(ngModel)]="firstName"
                required
                class="form-input">
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input
                type="text"
                id="lastName"
                name="lastName"
                [(ngModel)]="lastName"
                required
                class="form-input">
            </div>
          </div>
        </div>

        <!-- Account Information -->
        <div class="form-section">
          <h2 class="section-title">Account Information</h2>
          <div class="form-group">
            <label for="username">Username</label>
            <input
              type="text"
              id="username"
              name="username"
              [(ngModel)]="username"
              required
              minlength="4"
              maxlength="30"
              class="form-input">
            <p class="form-hint">4-30 characters. Changing username will require re-login.</p>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              [(ngModel)]="email"
              required
              class="form-input">
          </div>
        </div>

        <!-- Change Password -->
        <div class="form-section">
          <h2 class="section-title">Change Password</h2>
          <p class="section-description">Leave blank if you don't want to change your password</p>
          <div class="form-group">
            <label for="currentPassword">Current Password</label>
            <input
              type="password"
              id="currentPassword"
              name="currentPassword"
              [(ngModel)]="currentPassword"
              class="form-input">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input
                type="password"
                id="newPassword"
                name="newPassword"
                [(ngModel)]="newPassword"
                minlength="8"
                class="form-input">
              <p class="form-hint">At least 8 characters</p>
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                [(ngModel)]="confirmPassword"
                class="form-input">
            </div>
          </div>
        </div>
        <div class="danger-zone">
          <h2 class="section-title">Danger Zone</h2>
          <p class="section-description">Permanently delete your account. This action cannot be undone.</p>
          <div class="form-actions">
            <button type="button" class="btn-delete-account" (click)="deleteAccount()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-4.5l-1-1z"/>
              </svg>
              Delete Account
            </button>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="cancel()">Cancel</button>
          <button type="submit" class="btn-save" [disabled]="loading() || uploading()">
            @if (loading() || uploading()) {
              <span class="spinner-small"></span>
              {{ uploading() ? 'Uploading...' : 'Saving...' }}
            } @else {
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
              </svg>
              Save Changes
            }
          </button>
        </div>
      </form>
    }
  </div>
</div>
