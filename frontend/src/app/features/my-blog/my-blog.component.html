<div class="my-blog-page">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">My Blog</h1>
      <p class="page-subtitle">Manage your posts and share your thoughts with the world</p>
    </div>
    <button class="btn-new-post" (click)="createNewPost()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
      </svg>
      New Post
    </button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <p>Loading your posts...</p>
    </div>
  } @else {
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value">{{ totalPosts() }}</div>
        <div class="stat-label">Total Posts</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ totalLikes() }}</div>
        <div class="stat-label">Total Likes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">{{ totalComments() }}</div>
        <div class="stat-label">Total Comments</div>
      </div>
    </div>

    <!-- Posts Section -->
    <div class="posts-section">
      <h2 class="section-title">Your Posts</h2>

      @if (posts().length === 0) {
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z"/>
          </svg>
          <p>No posts yet. Create your first post to get started!</p>
          <button class="btn-create-first" (click)="createNewPost()">Create Post</button>
        </div>
      } @else {
        <div class="posts-list">
          @for (post of posts(); track post.id) {
            <div class="blog-post-card" [class.hidden-post]="post.hidden" (click)="viewPost(post.id)">
              <!-- Post Content -->
              <div class="post-content">
                <div class="post-header-row">
                  <h3 class="post-title">{{ post.title }}</h3>
                </div>

                <!-- Post Meta -->
                <div class="post-meta">
                  <span class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                    </svg>
                    {{ post.created_at | date: 'MMMM d, yyyy' }}
                  </span>
                  <span class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"/>
                    </svg>
                    {{ post.likeCount || 0 }}
                  </span>
                  <span class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                    </svg>
                    {{ post.comments.length || 0 }}
                  </span>
                  <span class="meta-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                    </svg>
                    {{ getReadingTime(post.content) }}
                  </span>
                </div>

                <!-- Actions -->
                <div class="post-actions">
                  <button class="action-btn" (click)="viewPost(post.id)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                    </svg>
                    View
                  </button>
                  <button class="action-btn" (click)="editPost(post.id, $event)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                    Edit
                  </button>
                  <button class="action-btn action-btn-danger" (click)="deletePost(post.id, $event)" [disabled]="deleting() === post.id">
                    @if (deleting() === post.id) {
                      <span class="spinner-small"></span> Deleting...
                    } @else {
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                      </svg>
                      Delete
                    }
                  </button>
                </div>
              </div>

              <!-- Post Thumbnail -->
              @if (post.media_url) {
                <div class="post-thumbnail">
                  @if (post.media_type === 'image') {
                    <img [src]="post.media_url" [alt]="post.title" />
                  } @else if (post.media_type === 'video') {
                    <video [src]="post.media_url"></video>
                  }
                </div>
              } @else {
                <div class="post-thumbnail-placeholder">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                  </svg>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>

<!-- New Post Modal -->
@if (showNewPostModal()) {
  <app-new-post-modal
    (close)="closeNewPostModal()"
    (postCreated)="onPostCreated()">
  </app-new-post-modal>
}

<!-- Edit Post Modal -->
@if (showEditPostModal() && selectedPost()) {
  <app-edit-post-modal
    [post]="selectedPost()!"
    (close)="closeEditPostModal()"
    (postUpdated)="onPostUpdated()">
  </app-edit-post-modal>
}
